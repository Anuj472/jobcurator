name: Post Jobs to LinkedIn

# Run twice daily: 9 AM and 6 PM IST (3:30 AM and 12:30 PM UTC)
on:
  schedule:
    - cron: '30 3 * * *'   # 9:00 AM IST
    - cron: '30 12 * * *'  # 6:00 PM IST
  # Manual trigger for testing
  workflow_dispatch:

jobs:
  post-linkedin-jobs:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ðŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ðŸ“¦ Install dependencies
        run: npm install

      - name: ðŸ“ Install TypeScript tools
        run: npm install -g tsx typescript @types/node

      - name: ðŸš€ Post jobs to LinkedIn
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
          LINKEDIN_ACCESS_TOKEN: ${{ secrets.LINKEDIN_ACCESS_TOKEN }}
          LINKEDIN_AUTHOR_URN: ${{ secrets.LINKEDIN_AUTHOR_URN }}
        run: |
          echo "ðŸš€ Starting daily LinkedIn job posting..."
          echo "Time: $(date)"
          tsx scripts/post-jobs-daily.ts
          echo "âœ… Job posting completed!"

      - name: ðŸ“Š Generate posting summary
        if: always()
        run: |
          echo "### LinkedIn Daily Job Posting Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Workflow**: Post Jobs to LinkedIn (2x Daily)" >> $GITHUB_STEP_SUMMARY
          echo "- **Schedule**: 9 AM & 6 PM IST" >> $GITHUB_STEP_SUMMARY
          echo "- **Status**: ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Time**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Configuration:**" >> $GITHUB_STEP_SUMMARY
          echo "- Posts per run: 2" >> $GITHUB_STEP_SUMMARY
          echo "- Jobs per post: 5" >> $GITHUB_STEP_SUMMARY
          echo "- Total jobs posted: 10" >> $GITHUB_STEP_SUMMARY
          echo "- Delay between posts: 20 minutes" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“Œ Check the logs above for detailed posting information" >> $GITHUB_STEP_SUMMARY